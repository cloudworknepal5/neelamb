<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nepali News Tool - Final Fix 2026</title>
    <script src="https://ad.neelamb.com/feeds/index_files/jquery.download"></script>
    <script src="https://ad.neelamb.com/feeds/index_files/jquery_002.download"></script>
    <script src="https://ad.neelamb.com/feeds/index_files/common.download"></script>
    <script src="https://ad.neelamb.com/feeds/index_files/convert.download"></script>
    <script src="https://ad.neelamb.com/feeds/index_files/kantipur.js.download"></script>
    <style>
        :root { --primary: #e74c3c; --accent: #4e73df; --bg: #f4f7f6; --dark: #2c3e50; --rtf: #8e44ad; --gmail: #d44638; --correct-color: #27ae60; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .top-editor { background: white; padding: 10px; border-bottom: 3px solid var(--primary); flex-shrink: 0; z-index: 100; }
        .converter-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        textarea { width: 100%; height: 100px; border: 1px solid #ccc; border-radius: 5px; padding: 8px; font-size: 14px; box-sizing: border-box; resize: none; }
        h3 { font-size: 10px; margin: 0 0 5px; color: var(--accent); text-transform: uppercase; }
        .btn-row { display: flex; gap: 4px; margin-top: 5px; flex-wrap: wrap; }
        .btn-tool { flex: 1; padding: 5px; font-size: 10px; border: none; border-radius: 3px; cursor: pointer; color: white; font-weight: bold; min-width: 45px; }
        .btn-conv { background: #4e73df; }
        .btn-copy { background: #27ae60; }
        .btn-clear { background: #7f8c8d; }
        .btn-rtf { background: var(--rtf); }
        .btn-correct { background: var(--correct-color); }
        .control-panel { background: var(--dark); padding: 8px; display: flex; gap: 8px; justify-content: center; flex-shrink: 0; align-items: center; flex-wrap: wrap; }
        .input-box { padding: 6px 10px; border-radius: 4px; border: none; font-size: 12px; width: 160px; }
        .btn-action { background: #27ae60; color: white; border: none; padding: 7px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: bold; }
        .btn-blue { background: #3498db; }
        .btn-rss { background: #f39c12; }
        .btn-gmail { background: var(--gmail); }
        .feed-shortcuts { background: #fff; padding: 5px; border-bottom: 1px solid #ddd; display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; flex-shrink: 0; }
        .btn-feed { background: #f8f9fa; border: 1px solid #ddd; padding: 4px 10px; border-radius: 15px; cursor: pointer; font-size: 11px; }
        .btn-feed.active { background: var(--primary); color: white; }
        .split-view { display: flex; flex: 1; overflow: hidden; background: #ccc; }
        .left-panel { width: 40%; background: white; overflow-y: auto; padding: 10px; border-right: 2px solid #ddd; box-sizing: border-box; }
        .right-panel { width: 60%; background: #eee; overflow-y: auto; box-sizing: border-box; display: flex; flex-direction: column; }
        .embed-card { background: white; border-radius: 8px; padding: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 10px;}
        .embed-card h2 { font-size: 14px; margin: 0 0 10px 0; color: var(--dark); border-left: 4px solid var(--primary); padding-left: 8px; }
        .embed-container { width: 100%; border: 1px solid #ddd; border-radius: 4px; overflow: hidden; background: white; }
        .browser-section { height: 600px; width: 100%; border-top: 5px solid var(--dark); margin-top: 10px; flex-shrink: 0; }
        iframe { width: 100%; height: 100%; border: none; background: white; }
        .news-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .post-card { border: 1px solid #eee; padding: 8px; border-radius: 6px; background: #fff; display: flex; flex-direction: column; }
        .f-img { width: 100%; height: 85px; object-fit: cover; border-radius: 4px; margin-bottom: 5px; }
        .post-title { font-size: 11px; font-weight: bold; color: #333; height: 32px; overflow: hidden; margin-bottom: 5px; line-height: 1.3; text-decoration: none; display: block; }
        .btn-add { background: #27ae60; color: white; border: none; padding: 6px; border-radius: 4px; cursor: pointer; font-size: 10px; font-weight: bold; }
        #copy-status { position: fixed; bottom: 20px; right: 20px; background: #27ae60; color: white; padding: 10px 20px; border-radius: 50px; display: none; z-index: 1000; font-weight: bold; }
    </style>
</head>
<body>
<div id="copy-status">Copied! ‚úÖ</div>
<div class="top-editor">
    <div class="converter-grid">
        <div class="card">
            <h3>‡•ß. Unicode</h3>
            <textarea id="unicode_text" oninput="autoProcess()"></textarea>
            <div class="btn-row">
                <button class="btn-tool btn-conv" onclick="autoProcess()">Convert</button>
                <button class="btn-tool btn-copy" onclick="copyTool('unicode_text')">Copy</button>
                <button class="btn-tool btn-clear" onclick="clearAllTools()">Clear</button>
            </div>
        </div>
        <div class="card">
            <h3>‡•®. Preeti</h3>
            <textarea id="legacy_text" style="font-family:'preeti';"></textarea>
            <div class="btn-row">
                <button class="btn-tool btn-conv" onclick="autoProcess()">Convert</button>
                <button class="btn-tool btn-copy" onclick="copyTool('legacy_text')">Copy</button>
                <button class="btn-tool btn-clear" onclick="clearAllTools()">Clear</button>
            </div>
        </div>
        <div class="card">
            <h3>‡•©. Himalb (Auto)</h3>
            <textarea id="himalb_output" style="font-family:'himalb';"></textarea>
            <div class="btn-row">
                <button class="btn-tool btn-conv" onclick="autoProcess()">Convert</button>
                <button class="btn-tool btn-copy" onclick="copyTool('himalb_output')">Copy</button>
                <button class="btn-tool btn-clear" onclick="clearAllTools()">Clear</button>
            </div>
        </div>
        <div class="card">
            <h3>‡•™. Word Correction (Final)</h3>
            <textarea id="corrected_output" style="font-family:'himalb';" placeholder="‡§∏‡•Å‡§ß‡§æ‡§∞‡§ø‡§è‡§ï‡•ã ‡§´‡§®‡•ç‡§ü ‡§Ø‡§π‡§æ‡§Å..."></textarea>
            <div class="btn-row">
                <button class="btn-tool btn-correct" onclick="applyFinalCorrection()">Convert</button>
                <button class="btn-tool btn-rtf" onclick="downloadRTF()">RTF</button>
                <button class="btn-tool btn-copy" onclick="copyTool('corrected_output')">Copy</button>
                <button class="btn-tool btn-clear" onclick="document.getElementById('corrected_output').value=''">Clear</button>
            </div>
        </div>
    </div>
</div>

<div class="control-panel">
    <button class="btn-action btn-rss" onclick="openRSSPopup()">RSS NEPAL POPUP</button>
    <div style="width:1px; height:20px; background:#555;"></div>
    <input type="text" id="custom_rss" class="input-box" placeholder="RSS Link...">
    <button class="btn-action" onclick="fetchFeed(document.getElementById('custom_rss').value)">‡§´‡§ø‡§° ‡§≤‡•ã‡§°</button>
    <input type="text" id="browser_url" class="input-box" placeholder="URL ‡§Ø‡§π‡§æ‡§Å...">
    <button class="btn-action btn-blue" onclick="loadBrowser()">‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§≤‡•ã‡§°</button>
    <button class="btn-action btn-gmail" onclick="window.open('https://mail.google.com/mail/u/0/?ui=2&fs=1&tf=cm', '_blank')">GMAIL</button>
</div>

<div class="feed-shortcuts" id="feed-buttons"></div>

<div class="split-view">
    <div class="left-panel">
        <div id="news-grid" class="news-grid"><p style="text-align:center; grid-column:span 2; padding:40px; color:#999;">‡§´‡§ø‡§° ‡§≤‡•ã‡§° ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§</p></div>
        <div class="load-more-box"><button id="load-more-btn" class="btn-load-more" onclick="displayMore()">‡§•‡§™ ‡§∏‡§Æ‡§æ‡§ö‡§æ‡§∞ ‡§≤‡•ã‡§° ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç ‚¨á</button></div>
    </div>
    <div class="right-panel">
        <div class="bottom-grid">
             <div class="embed-card"><h2>Preeti to Unicode Auto</h2><div class="embed-container" style="height: 650px;"><embed src="https://designers2077.github.io/PreetiToUnicodeAuto/" width="100%" height="100%"></div></div>
             <div class="embed-card"><h2>Himalb Converter</h2><div class="embed-container" style="height: 400px;"><embed src="https://firebasestorage.googleapis.com/v0/b/birgunj-debba.appspot.com/o/HIMALB.htm?alt=media&token=5892a863-f8de-46e1-80f7-391ae0f6fcce" width="100%" height="100%"></div></div>
             <div class="card"><h2>News Editor</h2><div class="embed-container" style="height: 400px;"><embed src="https://designers2077.github.io/newseditor/" width="100%" height="100%"></div></div>
        </div>
        <div class="browser-section"><iframe id="web_frame" name="web_frame" src="about:blank"></iframe></div>
    </div>
</div>

<script>
const correctionMap = {
    "‡§∏‡§ô‡•ç‡§ñ‡•ç‡§Ø‡§æ": "‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ", "‡§∂‡§§‡•ç‡§∞‡•Ä": "‡§∂‡§§‡•ç‡§∞‡•Å", "‡§â‡§ö‡•ç‡§õ‡•É‡§ô‡•ç‡§ñ‡§≤": "‡§â‡§ö‡•ç‡§õ‡•É‡§Ç‡§ñ‡§≤", "‡§≤‡•ç": "‡§≤‡•ç", "‡§∞‡•ç‡§∞‡•Å": "‡§∞‡•Å",
    ";√é\\of": ";+Vof", "zqL": "zq'", "pR5[√én": "pR5[+vn", "?{": "¬•", "n\\": "N"
};

function clearAllTools() {
    document.getElementById('unicode_text').value = "";
    document.getElementById('legacy_text').value = "";
    document.getElementById('himalb_output').value = "";
    document.getElementById('corrected_output').value = "";
}

function downloadRTF() {
    const text = document.getElementById('corrected_output').value || document.getElementById('himalb_output').value;
    if(!text) return alert("‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§õ‡•à‡§®‡•§");
    const rtfHeader = "{\\rtf1\\ansi\\deff0 {\\fonttbl {\\f0 Himalb;}}\n{\\f0\n";
    const rtfFooter = "\n}}";
    const blob = new Blob([rtfHeader + text + rtfFooter], {type: 'application/rtf'});
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = "News_Corrected_" + Date.now() + ".rtf";
    link.click();
}

function copyTool(id) {
    const box = document.getElementById(id);
    if (box.value.length > 0) {
        box.select();
        document.execCommand('copy');
        const status = document.getElementById('copy-status');
        status.innerText = "Copied! ‚úÖ";
        status.style.display = 'block';
        setTimeout(() => { status.style.display = 'none'; }, 2000);
    }
}

// Multi-function: ‡§∏‡•Å‡§ß‡§æ‡§∞‡•ç‡§®‡•á ‡§§‡§∞ ‡§Ö‡§ü‡•ã-‡§ï‡§™‡•Ä ‡§®‡§ó‡§∞‡•ç‡§®‡•á
function applyFinalCorrection() {
    const himalbVal = document.getElementById('himalb_output').value;
    const unicodeVal = document.getElementById('unicode_text').value;
    let sourceText = himalbVal || unicodeVal;
    if(!sourceText) return;
    let result = sourceText;
    Object.entries(correctionMap).forEach(([wrong, right]) => {
        result = result.split(wrong).join(right);
    });
    document.getElementById('corrected_output').value = result;
    // Auto Copy ‡§π‡§ü‡§æ‡§â‡§® ‡§Ø‡§π‡§æ‡§Å ‡§ï‡§™‡•Ä ‡§ó‡§∞‡•ç‡§®‡•á ‡§≤‡§ú‡§ø‡§ï ‡§∞‡§æ‡§ñ‡§ø‡§è‡§ï‡•ã ‡§õ‡•à‡§®
}

function autoProcess() {
    if (typeof convert_to_Preeti === "function") convert_to_Preeti(); 
    setTimeout(() => {
        const preetiVal = document.getElementById('legacy_text').value;
        if (typeof kantipurConfigToUnicode === "function" && preetiVal) {
            document.getElementById('himalb_output').value = kantipurConfigToUnicode(preetiVal);
            applyFinalCorrection(); // ‡§∏‡•Å‡§ß‡§æ‡§∞‡•ç‡§®‡•á ‡§ï‡§æ‡§Æ ‡§Ö‡§ü‡•ã ‡§π‡•Å‡§®‡•ç‡§õ, ‡§ï‡§™‡•Ä ‡§π‡•Å‡§Å‡§¶‡•à‡§®
        }
    }, 450);
}

const feeds = [
    { name: "Nepal Post", url: "https://nepalpostdaily.com/feed/" },
    { name: "Madhes Khabar", url: "https://feeds.feedburner.com/madheskhabar/pLihKdgaoDx" },
    { name: "Race Khabar", url: "https://racekhabar.com/feed/" },
    { name: "E-Shilalekh", url: "https://www.eshilalekh.com/feed" },
    { name: "Madhesh Sanchar", url: "https://madheshsanchar.com/feed" },
    { name: "Chandra Surya", url: "https://feeds.feedburner.com/chandrasuryawani/8iC1d0yoofl" },
    { name: "Desh Madhesh", url: "https://deshmadhesh.com/feed/" },
    { name: "Bara Update", url: "https://baraupdate.com.np/feed/" },
    { name: "Ghantaghar TV", url: "https://ghantaghartv.com/feed/" },
    { name: "Desh Sanchar", url: "https://www.deshsanchar.com/feed/" }
];

let allItems = []; let currentIndex = 0; const itemsPerPage = 10;
const btnContainer = document.getElementById('feed-buttons');
feeds.forEach(f => {
    const btn = document.createElement('button');
    btn.className = 'btn-feed'; btn.innerText = f.name;
    btn.onclick = () => { document.querySelectorAll('.btn-feed').forEach(b => b.classList.remove('active')); btn.classList.add('active'); fetchFeed(f.url); };
    btnContainer.appendChild(btn);
});

async function fetchFeed(url) {
    if(!url) return;
    const grid = document.getElementById('news-grid');
    grid.innerHTML = "<p style='grid-column: span 2; text-align:center;'>‡§§‡§æ‡§®‡§ø‡§Å‡§¶‡•à‡§õ...</p>";
    try {
        const res = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}&cache_boost=${Date.now()}`);
        const data = await res.json();
        if (data.status === "ok") { allItems = data.items; currentIndex = 0; grid.innerHTML = ""; displayMore(); }
    } catch (e) { grid.innerHTML = "Error!"; }
}

function displayMore() {
    const grid = document.getElementById('news-grid');
    const loadBtn = document.getElementById('load-more-btn');
    const nextItems = allItems.slice(currentIndex, currentIndex + itemsPerPage);
    nextItems.forEach((item, i) => {
        const globalIdx = currentIndex + i;
        const img = item.thumbnail || (item.enclosure ? item.enclosure.link : "") || "https://via.placeholder.com/150x100?text=News";
        grid.innerHTML += `<div class="post-card"><img src="${img}" class="f-img"><a href="${item.link}" target="web_frame" class="post-title" id="t-${globalIdx}">${item.title}</a><div id="c-${globalIdx}" style="display:none;">${(item.content || item.description || "").replace(/<[^>]*>?/gm, '')}</div><button class="btn-add" onclick="appendToEditor('t-${globalIdx}', 'c-${globalIdx}')">‡§•‡§™‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç +</button></div>`;
    });
    currentIndex += itemsPerPage;
    loadBtn.style.display = (currentIndex < allItems.length) ? 'inline-block' : 'none';
}

function appendToEditor(titleId, contentId) {
    const title = document.getElementById(titleId).innerText;
    const content = document.getElementById(contentId).innerText;
    const box = document.getElementById('unicode_text');
    box.value += (box.value ? "\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n" : "") + `üìå ${title}\n\n${content}`;
    autoProcess();
}

function openRSSPopup() { window.open("http://rssnepal.org.np/headlineNews/list?type=TEXT_NEPALI", 'RSS', `width=${window.screen.availWidth},height=${window.screen.availHeight/2},top=${window.screen.availHeight/2},left=0`); }
function loadBrowser() { let url = document.getElementById('browser_url').value.trim(); if(!url) return; if(!url.startsWith('http')) url = 'https://' + url; document.getElementById('web_frame').src = url; }
</script>
</body>
</html>
